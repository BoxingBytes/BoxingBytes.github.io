<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=c5d02b5abf9ae1b82c1a2be1ca00a668db55b240">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PufferLib+Vast.AI setup tutorial | BoxingBytes</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="PufferLib+Vast.AI setup tutorial" />
<meta name="author" content="Aguirre Max" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Reinforcement Learning is hard, and most environment setups are wonky, slow, too expensive to run, or can only run a handfull of environments." />
<meta property="og:description" content="Reinforcement Learning is hard, and most environment setups are wonky, slow, too expensive to run, or can only run a handfull of environments." />
<link rel="canonical" href="http://localhost:4000/2025/08/24/puffer-vast.html" />
<meta property="og:url" content="http://localhost:4000/2025/08/24/puffer-vast.html" />
<meta property="og:site_name" content="BoxingBytes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-08-24T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PufferLib+Vast.AI setup tutorial" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Aguirre Max"},"dateModified":"2025-08-24T00:00:00+02:00","datePublished":"2025-08-24T00:00:00+02:00","description":"Reinforcement Learning is hard, and most environment setups are wonky, slow, too expensive to run, or can only run a handfull of environments.","headline":"PufferLib+Vast.AI setup tutorial","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2025/08/24/puffer-vast.html"},"url":"http://localhost:4000/2025/08/24/puffer-vast.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>BoxingBytes</h1>
        </a>
        <h2>A blog about intelligence</h2>

        <section id="downloads">
          
          <a href="https://github.com/BoxingBytes/BoxingBytes.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p>Reinforcement Learning is hard, and most environment setups are wonky, slow, too expensive to run, or can only run a handfull of environments.</p>

<p>In this tutorial, we will see how to start an entire reinforcement learning setup in under 30’, which is fast, low cost, and gives you access to a lot of different environments, as well as built-in state of the art algorithms from which you can expand. This is using <a href="https://puffer.ai/">pufferlib</a>, a fast RL library.</p>

<p><strong>This tutorial involves a paid service to rent GPUs, altough it won’t be much, it isn’t free.</strong></p>

<h1 id="assumptions">Assumptions</h1>

<h2 id="budget">Budget</h2>
<p>I am a student, maximum budget I can afford was $20 a month if I sacrifice my monthly haircut.</p>

<h2 id="hardware">Hardware</h2>
<p>You have no GPU, either running on Linux or Windows machine, at least 16Gb RAM &amp; 20Gb free disk.</p>

<h2 id="software">Software</h2>
<p>Python 3.12</p>

<h2 id="knowledge">Knowledge</h2>
<p>You know:</p>
<ul>
  <li>Github</li>
  <li>What SSH &amp; SCP are</li>
  <li>What is a virtual environment and know about Python</li>
  <li>Know about WSL</li>
</ul>

<h1 id="the-setup">The setup</h1>

<p>You are GPU-poor? Don’t worry, I am too. You could run <a href="https://puffer.ai/">pufferlib</a> on cpu (I have done that a lot) but it’s better if you do on GPU.</p>

<p>We will rent GPUs on the Vast.ai platform. $0.15-$0.40 an hour.</p>

<ol>
  <li>You dev on your own computer on your pufferlib’s fork.</li>
  <li>Push changes</li>
  <li>Open your vastAI instance, pull your changes, start your experiments (most require 1-20min)</li>
  <li>SCP the weights and logs to your local computer</li>
  <li>Run eval / render on your own computer</li>
</ol>

<p><strong>Costs</strong>:</p>
<ul>
  <li>Most low scale research/experiments (95% people reading this): never need more than 1 hour ($0.15-$0.40)</li>
  <li>Running big sweeps on hard envs: maybe 24h ($3.6-$9.6)</li>
</ul>

<h1 id="setup-vastai">Setup Vast.ai</h1>

<p>Vast.ai is a platform where you can rent GPUs. Go to <a href="https://cloud.vast.ai/">Vast.ai website</a> and make an account. Put $5 in there. 
You will access your instance through ssh, so let’s set this up.</p>

<h2 id="ssh-keys">SSH Keys</h2>

<p>I recommend using WSL if you’re on Windows. Really, nothing hard to do: <a href="https://learn.microsoft.com/en-us/windows/wsl/install">WSL install guide</a>.</p>

<p>You can create your ssh keys on Ubuntu following those steps:</p>

<p><strong>Make your ssh folder if not already there</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.ssh 
<span class="nb">chmod </span>700 ~/.ssh
</code></pre></div></div>
<p><strong>Use ssh-keygen to generate an ssh key</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-f</span> ~/.ssh/&lt;name_your_key&gt;
</code></pre></div></div>
<p>You’ll be prompted to enter a password or press <em>ENTER</em> if you don’t want password. Your choice.</p>

<p><strong>Copy your key to use it later</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> ~/.ssh/&lt;your_key_name&gt;.pub
</code></pre></div></div>

<p><strong>Upload your key to your Vast.ai account</strong></p>

<p>Go to <em>Keys</em> on the left menu</p>

<p><img src="/assets/images/vastKeys.png" alt="vastKeys" /></p>

<p>then click on <em>New</em></p>

<p><img src="/assets/images/vastNewkey.png" alt="newKey" /></p>

<p>Paste your copied ssh key in there, starting with <em>ssh-…</em></p>

<h2 id="pick--start-your-instance">Pick &amp; Start your instance</h2>

<p>Go to templates on the left-side menu</p>

<p><img src="/assets/images/vast_leftmenu.png" alt="leftMenu" /></p>

<p>Type in <em>Ubuntu</em> and look for <em>Ubuntu XX.X VM</em>, then click <em>select</em></p>

<p><img src="/assets/images/vast_template.png" alt="vast template" /></p>

<p>Find one that make sense for you. Any 3090 will do for almost any standard experiments. Then click <em>Rent</em> on the right</p>

<p><img src="/assets/images/vastRenting.png" alt="vastRenting" /></p>

<p>After that, you will see in the left menu, under <em>Instances</em> the selected instance added to the list. It will take anywhere between 5 and 30’ to start and be available to you. Once it’s available, it will show like this, with the <em>&gt;_</em> icon opening the <em>ssh</em> command to connect to your instance.</p>

<p><img src="/assets/images/vastInstances.png" alt="VastInstances" /></p>

<p>While your instance is puffing up, keep going through this tutorial.</p>

<h1 id="fork-pufferlib">Fork pufferlib</h1>

<p>Go to <a href="https://github.com/pufferai/pufferlib">pufferlib github</a>, as of today, current branch is 3.0. Make your own fork.</p>

<p>Then clone your forked repo locally on your computer. You should have something like this: <img src="/assets/images/puffer_branches.png" alt="puffer fork branches" /></p>

<p>Making pufferlib work without GPU is really much better with virtual environment. So I recommend making one</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">--version</span>
Python 3.12.10
<span class="nv">$ </span>python <span class="nt">-m</span> venv venv
<span class="nv">$ </span><span class="nb">source </span>venv<span class="se">\b</span><span class="k">in</span><span class="se">\a</span>ctivate
</code></pre></div></div>

<p>Then install with pip in editable mode. You will need some tweaks, installing some more required dependencies.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
</code></pre></div></div>
<p>You may want to change the default config to using <em>cpu</em> in <code class="language-plaintext highlighter-rouge">config/default.ini</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>device = cpu
</code></pre></div></div>

<h1 id="connect-to-your-vastai-instance">Connect to your Vast.ai instance</h1>

<p>Now that it should be ready, open a terminal on your local computer and enter the ssh command</p>

<p><img src="/assets/images/sshcmd.png" alt="ssh_cmd" /></p>

<p>You’ll be asked if you’re sure you know the host’s key, say <em>yes</em>. You should see a welcome message and your prompt now show you’re connected to your instance. You can type in</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvidia-smi
</code></pre></div></div>
<p>Which will display your GPU specs.</p>

<p><img src="/assets/images/nvidia_smi.png" alt="nvidia_smi" /></p>

<p><em>YAY!</em></p>

<h1 id="get-pufferlib-on-your-instance">Get pufferlib on your instance</h1>

<p>Now the easiest way to get pufferlib working on a GPU instance is to get the docker container named <em>puffertank</em> which already has everything you need to make it work. Puffertank does not work as of today if you do not have a GPU, that’s why I showed you the <code class="language-plaintext highlighter-rouge">pip install</code>route earlier for local install. The following is on the puffer website doc: <a href="https://puffer.ai/docs.html">puffer doc</a></p>

<p>From your instance, type:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/pufferai/puffertank
<span class="nb">cd </span>puffertank
./docker.sh <span class="nb">test</span>
</code></pre></div></div>

<p>This will take a moment (&lt;3min). Once it’s done, you should have a nice puffer prompt:</p>

<p><img src="/assets/images/puffertank.png" alt="puffertank" /></p>

<h1 id="optional-set-up-neovim-config">(Optional) Set up neovim config</h1>

<p>Puffertank comes with a nice Neovim config which you can use, takes 1min to install and is free. To do so open Neovim:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim
</code></pre></div></div>
<p>Then <code class="language-plaintext highlighter-rouge">:PlugInstall</code>. You should be prompted about supermaven api key but you can use it in free mode. If not prompted, just quit <code class="language-plaintext highlighter-rouge">:q</code> and open any file</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim pufferlib/pufferl.py
</code></pre></div></div>
<p>A message should display about supermaven, type in vim <code class="language-plaintext highlighter-rouge">:SupermavenUseFree</code> to use for free.</p>

<p><img src="/assets/images/freemaven.png" alt="freemaven" /></p>

<h1 id="get-your-fork-in-there-so-you-can-run-experiments">Get your fork in there so you can run experiments</h1>

<p>Now is time to add your fork and be ready to run your experiments. From inside puffertank:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote add myfork https://github.com/YOURNAME/pufferlib.git
git fetch myfork
git checkout <span class="nt">-b</span> mybranch myfork/branchname
pip <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
</code></pre></div></div>

<p>This should take ~2min.</p>

<h1 id="run-an-experiment">Run an experiment</h1>

<p>Let us run a basic experiment with pufferlib. Ocean are a</p>
<blockquote>
  <p>growing collection of 1st party environments. Most run 1M+ agent steps per second per CPU 
core. They are implemented in pure C.</p>
</blockquote>

<p>They have cartpole implemented in C. To train:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puffer train puffer_cartpole
</code></pre></div></div>

<p>Runs at 3.5M SPS on this rented GPU
<img src="/assets/images/cartpole_puffer.png" alt="cartpoletrains" /></p>

<p><em>YAY, YAY!</em></p>

<p>Now you would like to get your weights and logs home, wouldn’t you?</p>

<h1 id="get-the-weights-and-render-on-local-computer">Get the weights and render on local computer</h1>

<p>The experiment files are stored in <code class="language-plaintext highlighter-rouge">experiments/</code> in pufferlib.</p>

<p>Exit the container:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">exit</span>
</code></pre></div></div>
<p>Now you’re back into the host VM. Make a folder where we will copy the container files in, before we can <em>scp</em> from our local machine</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/experiments 
docker <span class="nb">cp </span>puffertank:/puffertank/pufferlib/experiments/. ~/experiments
</code></pre></div></div>

<p>Now, go back to your local machine, and open a terminal (I’m doing this from WSL):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp <span class="nt">-r</span> <span class="nt">-P</span> &lt;SSHPORT&gt; root@&lt;VAST_HOST_IP&gt;:~/experiments/<span class="k">*</span> /&lt;path_to_your_local_pufferlib&gt;/experiments/
</code></pre></div></div>

<p>Now from within your pufferlib repo locally, you should have the files in your <code class="language-plaintext highlighter-rouge">experiments</code> folder:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lt</span> experiments/ | <span class="nb">head</span> <span class="nt">-n</span> 3
total 6916
<span class="nt">-rw-r--r--</span> 1 m1000 m1000  536994 Aug 31 14:16 puffer_cartpole_175664206340.pt
drwxr-xr-x 2 m1000 m1000    4096 Aug 31 14:16 puffer_cartpole_175664206340
</code></pre></div></div>

<p>Having activated your virtual environment, you can now eval the trained model:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puffer <span class="nb">eval </span>puffer_cartpole <span class="nt">--load-model-path</span> latest
</code></pre></div></div>
<p>And this should display your cartpole trained agent! 
<img src="/assets/videos/cartpole_eval.gif" alt="cartpole_trained" /></p>

<p><em>YAY, YAY, YAY!!!</em></p>

<h1 id="2-ways-of-terminating-your-vastai-instance">2 ways of terminating your Vast.ai instance</h1>

<h2 id="stopping-your-instance-i-do-not-recommend">Stopping your instance (I do not recommend)</h2>
<p>You can <em>stop</em> your instance. The Vast.ai cost is divided into two sections: <em>GPU</em> and <em>Disk</em> - go on the <em>Billing</em> section on the left menu in Vast.ai. When you stop your instance, you still get billed the <em>Disk</em> costs. The pros should be that you keep your data and everything you have on your host instance. Altough very low cost, your GPU can still be rented out to someone else, and not be available when you want to start it again later ! (This is what enables this renting service to be so cheap, so I won’t complain). Therefore, my advice is destroy your instance.</p>

<h2 id="destroying-your-instance">Destroying your instance</h2>

<p>That’s what I do. All your billing are stopped, but you will loose everything that is on your VM, so make sure you collected everything you needed beforehand.</p>

<p>If you’re really broke and can’t afford to let your instance run for too long, you can do like me, spin up a new instance each time. With a little planning, start your instance on Vast.ai ~15’ before you start your work, and then all it takes is ~10’ to set everything up.</p>

<p>How I do is when I dev &amp; work on new algorithms &amp; envs, I just use my local computer, to make sure things run. But as soon as I want to fully train an agent or run sweeps, I’ll prepare in advance the list of things I need to run, spin up an instance, and then collect all the required files, before shutting down my instance.</p>

<h1 id="going-further">Going further</h1>

<p>If you want now, you can go read in more depth the <a href="https://puffer.ai/docs.html">puffer documentation</a>. 
Make your own environment, modify the algorithm, anything you want. Read Joseph’s articles to help you get started with pufferlib, or in RL in general: <a href="https://x.com/jsuarez5341/articles">Joseph’s X articles</a></p>

<p>Don’t forget to start pufferlib on <a href="https://github.com/pufferai/pufferlib">github</a> ! 
<img src="/assets/images/starPuffer.png" alt="starPuffer" /></p>

      </section>
    </div>
  </body>
</html>
